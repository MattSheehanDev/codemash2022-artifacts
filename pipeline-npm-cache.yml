trigger:
  branches:
    include:
      - master
  paths:
   include:
     - pipeline-npm-cache.yml

resources:
  repositories:
    - repository: nodejs-example    # Name used during the checkout step
      type: Github
      endpoint: MattSheehanDev      # Service Connection name
      name: gothinkster/node-express-realworld-example-app

variables:
  YARN_CACHE_FOLDER: $(Pipeline.Workspace)/.yarn

pool:
  vmImage: ubuntu-latest

stages:
  - stage: Yarn
    displayName: Yarn Install
    jobs:
      - job: Publish
        steps:
          - checkout: nodejs-example
          - task: Cache@2
            inputs:
              key: '"yarn" | "$(Agent.OS)" | yarn.lock'
              restoreKeys: |
                yarn | "$(Agent.OS)"
                yarn
              path: $(YARN_CACHE_FOLDER)
            displayName: Cache Yarn packages

          - script: yarn cache dir
          - script: yarn --frozen-lockfile
